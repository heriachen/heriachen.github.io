---
layout:     post
title:      Vulhub漏洞复现合集（下）
subtitle:   漏洞复现
date:       2020-10-16
author:     heria
header-img: img/post-bg-005.jpg
catalog: true
tags:
---

### CVE-2017-1000353 Jenkins-CI 远程代码执行漏洞

##### 漏洞简介及影响范围

Jenkins的反序列化漏洞，攻击者使用该漏洞可以在被攻击服务器执行任意代码，漏洞利用不需要任何的权限

漏洞影响范围：

所有Jenkins主版本均受到影响(包括<=2.56版本)
所有Jenkins LTS 均受到影响( 包括<=2.46.1版本)

##### 利用过程

生成序列化字符串

参考<https://github.com/vulhub/CVE-2017-1000353>，首先下载[CVE-2017-1000353-1.1-SNAPSHOT-all.jar](https://github.com/vulhub/CVE-2017-1000353/releases/download/1.1/CVE-2017-1000353-1.1-SNAPSHOT-all.jar)，这是生成POC的工具。

执行下面命令，生成字节码文件：

```bash
java -jar CVE-2017-1000353-1.1-SNAPSHOT-all.jar jenkins_poc.ser "command"
# jenkins_poc.ser是生成的字节码文件名
# "command ..."是待执行的任意命令
```

生成jenkins.ser文件 作用是在tmp文件夹下创建succc文件

![image-20210402135414150](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135414150.png)

发送数据包，执行命令

下载[exploit.py](https://github.com/vulhub/CVE-2017-1000353/blob/master/exploit.py)，(https://github.com/vulhub/CVE-2017-1000353/blob/master/exploit.py)， python3执行`python exploit.py http://your-ip:8080 jenkins.ser`，将刚才生成的字节码文件发送给目标

![image-20210402135433864](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135433864.png)

成功创建

![image-20210402135449599](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135449599.png)

更换反弹shell代码

![image-20210402135502880](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135502880.png)

执行后未能成功建立连接

尝试创建文件 之后通过echo 写入内容

![image-20210402135517862](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135517862.png)

执行后未能成功创建

![image-20210402135537565](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135537565.png)

更换思路 通过curl 下载文件  之后bash执行

创建名为1.txt文件 写入反弹shell语句

![image-20210402135556366](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135556366.png)

开启http服务 

![image-20210402135611051](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135611051.png)

访问对应端口

![image-20210402135624959](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135624959.png)

生成下载的序列化语句

![image-20210402135645784](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135645784.png)

执行

![image-20210402135700038](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135700038.png)

成功创建

![image-20210402135717295](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135717295.png)

再次生成一个序列化语句文件  内容为执行1.sh

![image-20210402135731632](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135731632.png)

执行

![image-20210402135747007](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135747007.png)

成功建立连接

![image-20210402135758644](https://raw.githubusercontent.com/heriachen/cloudimg/main/img2/image-20210402135758644.png)

